<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="My personal site">
<meta name="author" content="Snoozetime">
<title>Snoozetime's webpage | Snoozetime's webpage</title>
<link href="assets/css/font-awesome.css" rel="stylesheet" type="text/css">
<link href="assets/css/code.css" rel="stylesheet" type="text/css">
<link href="assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="assets/css/base.css" rel="stylesheet" type="text/css">
<link href="assets/css/layout.css" rel="stylesheet" type="text/css">
<link href="assets/css/skeleton.css" rel="stylesheet" type="text/css">
<link href="assets/css/screen.css" rel="stylesheet" type="text/css">
<link href="assets/css/custom.css" rel="stylesheet" type="text/css">
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
</head>
<body>
    <div class="container">
        <div class="four columns sidebar">
            <nav><!--Sidebar content--><h1 id="blog-title">
                <a href="http://snoozetime.github.io/" title="Snoozetime's webpage">Snoozetime's webpage</a>
            </h1>
            <hr>
<p> My personal site</p>
            
            <hr>
<div id="social">
            
    

            </div>
            
    <ul>
<li> <a href="#"> Home </a> </li>
            <li> <a href="archive.html"> Archives </a> </li>
            <li> <a href="categories/index.html"> Tags </a> </li>
            <li> <a href="rss.xml"> RSS </a> </li>
    </ul>
<hr></nav>
</div>
        <div class="eleven columns content">
            
        
    <div class="postbox">
        <h1>
                <a href="posts/code-generation-python/">Code generation with Python - How learning Python can save you a bunch of time</a>
        </h1>
        <div class="post"> <p>
More often than not, working in a IT project requires a lot of repetitive
tasks. In particular, one area that can be very debilitating is the creation
of test data. We know it is indispensable to the project, but it does not
make that task less boring.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Let's consider this example</h2>
<div class="outline-text-2" id="text-1">
<blockquote>
<p>
You are working in a Java project. One of the thing to test is the validation
logic of some input XML files. One object, called the
XmlInputSuperbEnterpriseValidator (notice the Java naming convention), takes
a XML file path as input and return true if the file is valid.
</p>
</blockquote>

<p>
Input file is just a simple XML file, which could look like this:
</p>
<div class="highlight"><pre><span></span>&lt;root&gt;
  &lt;value1&gt;1&lt;/value1&gt;
  &lt;value2&gt;a&lt;/value2&gt;
&lt;/root&gt;
</pre></div>
<p>
where value1 accepts number between 0 and 9 and value2 accepts letters (a-z).
</p>

<p>
To test this, one can create a test class like the following.
</p>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.core.validator</span><span class="o">;</span>

<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XmlInputSuperEnterpriseValidatorTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="mo">01_</span><span class="n">normalInput_returnsTrue</span><span class="o">()</span> <span class="o">{</span>
	 <span class="n">assertTrue</span><span class="o">(</span><span class="n">XmlInputSuperbEnterpriseValidator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">"input/01.xml"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>
Then, for each test case, create the XML file and add exactly the same test
function.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">When things go sideways</h2>
<div class="outline-text-2" id="text-2">
<p>
What if you have 50 different permutations of XML file. You'll need to create
all of them and create the exact same test methods. And what if the
specification change and you have to add new fields? Here again, a lot of
manual operation will be required to update the test cases.
</p>

<p>
What could happen here is that the tests will just be thrown away as the
maintenance is taking more effort that most people are willing to give.
</p>

<p>
As a good little software engineer, one of the question that should pop out
of your mind is: "Isn't there a better way to do that?"
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Of course there is a better way</h2>
<div class="outline-text-2" id="text-3">
<p>
It's not rocket science, but using python (or any other language really) to
automate the test creation will save you a bunch of time and also make
everybody in the project happier.
</p>

<p>
The basic workflow is the following:
</p>
<ol class="org-ol">
<li>Create test data definition: It could be just a simple text file that
describes the tests you want to run.
</li>
<li>Run the script to generate the data and the test class
</li>
<li>Run the tests and enjoy
</li>
</ol>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Test definition</h3>
<div class="outline-text-3" id="text-3-1">
<p>
The test definition is the input of the generator. We need to specify what
kind of test data we want to generate. In this example, we want to generate
tests that will try all possible permutations for value1 and value2 of the
input file.
</p>

<p>
The format of the test definition is up to you; here we will just use plain
text.
</p>

<blockquote>
<p>
1,2,3,4,5,6,7,8,9
</p>

<p>
a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Generating the test data and test class</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1">Representing our test data in Python</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
First things first, let's create a class that will represent the data for one
test:
</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">class</span> <span class="nc">TestData</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">value1</span> <span class="o">=</span> <span class="n">value1</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">value2</span> <span class="o">=</span> <span class="n">value2</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</pre></div>

<p>
We have our test data representation, great. Now we need a way to convert it
to text. We could just use Python string interpolation but there is a much
better way.
</p>
</div>
</div>

<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2">Templating language, Yokoso</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
A very neat way to generate text file in python is to use a templating
language. Web frameworks, such as Django or Flask, are heavy users of templating
language to generate the HTML pages from data coming from the server.
</p>

<p>
Here, we will use <a href="http://jinja.pocoo.org/docs/2.10/">jinja2</a> to generate our XML and java files.
First, define the template using jinja templating language. Quick way is just
to define it as a string in the python file but it can also be read from file,
which is better practice when the templates are getting bigger and more numerous.
</p>

<div class="highlight"><pre><span></span><span class="n">XML_TEMPLATE</span> <span class="o">=</span> <span class="s2">"""&lt;root&gt;</span>
<span class="s2">    &lt;value1&gt;{{ test_case.value1 }}&lt;/value1&gt;</span>
<span class="s2">    &lt;value2&gt;{{ test_case.value2 }}&lt;/value2&gt;&gt;</span>
<span class="s2">&lt;/root&gt;</span>
<span class="s2">"""</span>
</pre></div>

<p>
Notice the curly brackets? Jinja will replace what's inside by whatever objects
we pass. Object should have variables 'value1' and 'value2' to work.
</p>

<p>
The next snippet will print this template with a test case object.
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__name__"</span><span class="p">:</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">XML_TEMPLATE</span><span class="p">)</span>
    <span class="n">test_case</span> <span class="o">=</span> <span class="n">TestCase</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">,</span> <span class="s1">'value1'</span><span class="p">,</span> <span class="s1">'value2'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">test_case</span><span class="o">=</span><span class="n">test_case</span><span class="p">)</span>
</pre></div>

<p>
We insert the test<sub>case</sub> variable in the template by passing it as a keyword argument
of the render method of jinja2.Template. This will print:
</p>

<blockquote>
<p>
&lt;root&gt;
    &lt;value1&gt;value1&lt;/value1&gt;
    &lt;value2&gt;value2&lt;/value2&gt;&gt;
&lt;/root&gt;
</p>
</blockquote>

<p>
Creating the template for the java test class can be done in a similar fashion.
Here, we will leverage the for loop of jinja.
</p>

<div class="highlight"><pre><span></span><span class="n">JAVA_TEMPLATE</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">package com.core.validator;</span>

<span class="s2">import static org.junit.Assert.*;</span>

<span class="s2">public class XmlInputSuperbEnterpriseValidatorTest {</span>

<span class="s2">    {</span><span class="si">% f</span><span class="s2">or test_case in test_cases %}</span>
<span class="s2">    @Test</span>
<span class="s2">    public void {{ test_case.name}}() {</span>
<span class="s2">	 assertTrue(XmlInputSuperbEnterpriseValidator.validate("{{ test_case.path }}{{ test_case.name}}"));</span>
<span class="s2">    }</span>
<span class="s2">    {</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">}</span>

<span class="s2">"""</span>
</pre></div>

<p>
The variable to insert in the template is test<sub>cases</sub>. It should be an iterable as we use
it in the for loop. Here how to generate 1000 test cases with the java class to test them.
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__name__"</span><span class="p">:</span>
    <span class="n">java_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">JAVA_TEMPLATE</span><span class="p">)</span>
    <span class="n">xml_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">XML_TEMPLATE</span><span class="p">)</span>

    <span class="n">path_out</span> <span class="o">=</span> <span class="s2">"/somewhere/you/want/"</span>
    <span class="n">test_cases</span> <span class="o">=</span> <span class="p">[</span><span class="n">TestCase</span><span class="p">(</span><span class="s2">"{}_test"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
			   <span class="n">path_out</span><span class="p">,</span>
			   <span class="n">i</span><span class="p">,</span>
			   <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
    <span class="c1"># Create the java file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_out</span> <span class="o">+</span> <span class="s1">'XmlInputSuperbEnterpriseValidatorTest.java'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">java_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">test_cases</span><span class="o">=</span><span class="n">test_cases</span><span class="p">)</span>

    <span class="c1"># Create the xml files</span>
    <span class="k">for</span> <span class="n">test_case</span> <span class="ow">in</span> <span class="n">test_cases</span><span class="p">:</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_out</span> <span class="o">+</span> <span class="n">test_case</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="n">test_case</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
	    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xml_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">test_case</span><span class="o">=</span><span class="n">test_case</span><span class="p">))</span>
</pre></div>

<p>
Instead of printing the rendered templates to the console, we will just write them to
a file.
</p>
</div>
</div>

<div id="outline-container-sec-3-2-3" class="outline-4">
<h4 id="sec-3-2-3">Glue everything together</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
We have a way to represent our tests, we have a way to print our tests to file, we just need
to have a way to read our test specification and convert it to a TestCase object.
</p>

<p>
Our input file first line is the value1, and the second line is the value2. To avoid cluttering
the blog post, I will assume the file is always correct and has as many elements in the first
line than in the second line.
</p>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'test_specification'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">test_input_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
<span class="n">values1</span> <span class="o">=</span> <span class="n">test_input_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">values2</span> <span class="o">=</span> <span class="n">test_input_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

<p>
Then you can combine these value the way you want to create your test cases.
</p>

<p>
Using zip:
</p>
<div class="highlight"><pre><span></span><span class="n">test_cases</span> <span class="o">=</span> <span class="p">[</span><span class="n">TestCase</span><span class="p">(</span><span class="s1">'{}_test'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb</span><span class="p">),</span>
		       <span class="n">path_out</span><span class="p">,</span>
		       <span class="n">value1</span><span class="p">,</span>
		       <span class="n">value2</span><span class="p">)</span> <span class="k">for</span> <span class="n">nb</span><span class="p">,</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">values1</span><span class="p">,</span> <span class="n">values2</span><span class="p">))]</span>
</pre></div>

<p>
zip will create a generator from many iterables. The ith element of a zip object is a tuple containing
the ith elements of each of the input iterables. For example,
</p>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"{} - {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>

<p>
Will print "1 - 2" and "3 - 4".
</p>

<p>
zip is combined with enumerate. Enumerate is also very simple. It takes an iterator. The ith element
of enumerate is (i, ith element of input iterator).
</p>

<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"Index {}: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">el</span><span class="p">))</span>
</pre></div>
<p>
Will print "Index 0: a" and "Index 1: b". Notice that when combining zip with enumerate, you need
to add brackets when unpacking the values. Not using brackets would throw a ValueError (not enough
values to unpack (expected 3, got 2). The reason is that enumerate is sending a tuple of size two.
</p>

<p>
Another way to combine test cases is to use itertools.product. Product will yield all combinaisons
possible of multiple iterables.
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"{} - {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>

<p>
will print:
1 - a
1 - b
1 - c
2 - a
2 - b
2 - c
</p>

<p>
You can use product to test all the possible combinaisons of your input values.
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="n">test_cases</span> <span class="o">=</span> <span class="p">[</span><span class="n">TestCase</span><span class="p">(</span><span class="s1">'{}_test'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb</span><span class="p">),</span>
		       <span class="n">path_out</span><span class="p">,</span>
		       <span class="n">value1</span><span class="p">,</span>
		       <span class="n">value2</span><span class="p">)</span> <span class="k">for</span> <span class="n">nb</span><span class="p">,</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">values1</span><span class="p">,</span> <span class="n">values2</span><span class="p">))]</span>
</pre></div>

<p>
There is so much to say about generators, iterators.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Generalizing this approach</h2>
<div class="outline-text-2" id="text-4">
<p>
In this post, we learned about how to use python and jinja2 to automate test creation. Instead of
spending your precious time writing boilerplate code, you can just focus on what you want to test.
</p>

<p>
This is a simple example, the concept of automation is very powerful and helps tremendously in every
day life. Even if your activities do not imply coding, there must be some repetitive task that can
be automize. For example, sending the same mail to each mail address in an excel spreadsheet. This
can be automized (see pandas to read from excel file).
</p>

<p>
If you're interested in the subject, have a look at the following:
</p>
<ul class="org-ul">
<li>Automate
</li>
</ul>
</div>
</div> </div>
        
    <div class="meta">
        <span class="date">
            <time class="published" datetime="2018-05-02T00:00:00+09:00">2018-05-02 00:00</time></span>
        <ul class="tags">
<li><a href="categories/programming/">programming</a></li>
            <li><a href="categories/python/">python</a></li>
        </ul>
<span class="comment-count">
            
        
    <a href="http://snoozetime.github.io/posts/code-generation-python/#disqus_thread" data-disqus-identifier="cache/posts/code_generation_with_python.html">Comments</a>


        </span>
    </div>

    </div>

        
    <div class="postbox">
        <h1>
                <a href="posts/fantasy-novel-series-and-the-wait/">Fantasy novel series, and the Wait</a>
        </h1>
        <div class="post"> <p>
I've always been an avid reader of long fantasy novel series. As a kid, I used
to read Lord of the ring, Harry Potter (does it count? Yes it does!) and
basically everything I could put my hand on.
</p>

<p>
More recently I've been a huge fan of the work of Brandon Sanderson. For those
who don't know, Sandersonis the epic fantasy writer. He builds entire world
in different series of books that are somewhat connected in the
grander scheme: <a href="https://brandonsanderson.com/">Sanderson website</a>
</p>

<p>
So yes, I really love epic Fantasy. But amazing book series come with a big
caveat: the Wait. As opposed to the Thrill while reading, the Wait is the
excruciable period from when I finish a book until the next one is released.
Let's take a few example: The Stormlight Archive by Sanderson is a novel
series which contains 3 books at the moment:
</p>
<ul class="org-ul">
<li>The Way of Kings, published August 31, 2010
</li>
<li>Words of Radiance, published March 4, 2014
</li>
<li>Oathbringer, published November 14, 2017
</li>
</ul>
<p>
I've been in a state of passive suffering for at least 7 years.
</p>

<p>
Another great series of novel is <i>The Kingkiller Chronicle</i> by Patrick
Rothfuss. Here, the last book has been published 7 years ago!
</p>

<p>
And also, Game of Thrones people?
</p>

<p>
To be clear, I am very grateful to the authors out there that are
publishing these fantastic books. But how to satisfy the Wait? I've found
two ways some far:
</p>
<ol class="org-ol">
<li>Read more novels. This has the benefit of making me forget a bit about
the previous book I read, but it might add more series to the wait list.
</li>
<li>Read novel series that have already ended. That way no more wait. Just a
feeling of emptiness at the end.
</li>
</ol>
</div>
        
    <div class="meta">
        <span class="date">
            <time class="published" datetime="2018-04-26T14:25:14+09:00">2018-04-26 14:25</time></span>
        <ul class="tags">
<li><a href="categories/fantasy/">fantasy</a></li>
            <li><a href="categories/reading/">reading</a></li>
        </ul>
<span class="comment-count">
            
        
    <a href="http://snoozetime.github.io/posts/fantasy-novel-series-and-the-wait/#disqus_thread" data-disqus-identifier="cache/posts/fantasy-novel-series-and-the-wait.html">Comments</a>


        </span>
    </div>

    </div>

        
    <div class="postbox">
        <h1>
                <a href="posts/creating-notes-for-different-project-with-orgmode-and-emacs/">Creating notes for different project with Orgmode and Emacs</a>
        </h1>
        <div class="post"> <p>
I'm always amazed when I watch people mastering emacs. They can do everything
so much faster and with less keystrokes. However, if you have no experience with
elisp like me, extending emacs to do what I want seems like a daunting task.
</p>

<p>
As always, reading books and blogs about Emacs can help (ironic that I am writing about this isn't it),
but practice beats everything when it comes to learing a new programming language.
That's why, after doing 20 times the same operation, I decided to implement some shortcut in Elisp.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">What I am trying to achieve</h2>
<div class="outline-text-2" id="text-1">
<p>
I am working in multiple projects at a time, both in my professional and personal
life so I need to way to create notes quickly, and organize them so that I can
find them easily. I used to use Evernote for this but after switching everything
to Emacs I prefer using Orgmode.
</p>

<p>
My custom Emacs command will prompt me for a project and a note name, and will
create a file in the correctly directory that I can edit.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Let's dissect the problem a bit</h2>
<div class="outline-text-2" id="text-2">
<p>
Here I need a way to:
</p>
<ul class="org-ul">
<li>Find the list of my current projects
</li>
<li>Get a name for the new note
</li>
<li>Create the file name from above
</li>
<li>Create the note and switch to orgmode
</li>
</ul>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">How to test Elips easily</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Elisp is much easier when you can test commands one by one. There is a good tutorial <a href="https://learnxinyminutes.com/docs/elisp/">here</a> on lisp-interaction-mode.
This tutorial also links the great essay by Norvig about how to learn a programming language so I thought it was
appropriate to link it <a href="http://norvig.com/21-days.html">here</a> as well.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Find all the projects</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Projects here are represented as subdirectory of the projects folder. Basically, the folders are structured as: ~/notes/projects/,
so notes for project 'example' would be stored under ~/notes/projects/example/.
</p>

<p>
Here comes the first function. It will fetch all the directories under the projects folder and ask the user to choose one.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defvar</span> <span class="nv">my/project-path</span> <span class="s">"~/notes/projects"</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defun</span> <span class="nv">my/pick-project</span> <span class="p">()</span>
  <span class="s">"Prompt user to pick a choice from a list."</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">choices</span> <span class="p">(</span><span class="nf">directory-files</span> <span class="nv">my/project-path</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">message</span> <span class="s">"%s"</span> <span class="p">(</span><span class="nf">completing-read</span> <span class="s">"Open bookmark:"</span> <span class="nv">choices</span> <span class="p">))))</span>
</pre></div>

<p>
Here, <i>directory-files</i> will list all the files in the given directory (one improvement would be to keep only folders).
Next line will prompt me for a choice in this list of file and will return my choice.
</p>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Get a note name</h3>
<div class="outline-text-3" id="text-2-3">
<p>
To read a string from an user, read-string is the way to go.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my/choose-note-name</span> <span class="p">()</span>
  <span class="s">"Prompt user to choose a note name"</span>
  <span class="p">(</span><span class="nf">read-string</span> <span class="s">"Choose the note name: "</span><span class="p">))</span>
</pre></div>

<p>
This will open a mini-buffer and will display "Choose the note name: ". It will return the user's answer.
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Concatenate everything to get the note path</h3>
<div class="outline-text-3" id="text-2-4">
<p>
I played around a bit with clojure so I was expecting concatenating a list of strings to be as easy, but unfortunatly
it is slightly more complicated here. I am using the concatenate function that requires a type specifier.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">concatenate</span> <span class="ss">'string</span> <span class="s">"string1"</span> <span class="s">"string2"</span><span class="p">)</span>
</pre></div>

<p>
In the next function, I am also using the let form which let (:')) me write cleaner code.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my/create-note-name</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">project-name</span> <span class="p">(</span><span class="nf">my/pick-project</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">note-name</span> <span class="p">(</span><span class="nf">my/choose-note-name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">concatenate</span> <span class="ss">'string</span>
		 <span class="nv">me/project-path</span>
		 <span class="s">"/"</span>
		 <span class="nv">project-name</span>
		 <span class="s">"/"</span>
		 <span class="nv">note-name</span>
		 <span class="s">".org"</span><span class="p">)))</span>
</pre></div>

<p>
The hardcoded slashes are ugly and I pretty sure there is a better way to create the path from tokens…
</p>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">Create the note</h3>
<div class="outline-text-3" id="text-2-5">
<p>
You can use find-file to create a file and edit it in the current window. In my case, I want to open a new window to edit
the note so I am using find-file-other-window instead.
</p>

<p>
The function looks like:
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my/create-new-project-note</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">filename</span> <span class="p">(</span><span class="nf">my/create-note-name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">find-file-other-window</span> <span class="nv">filename</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">org-mode</span><span class="p">)))</span>
</pre></div>

<p>
Notice (interactive) which is there to make the function available when typing M-x. (org-mode) is also called after switching
buffer so that the correct mode is used for editing the note.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">It's done! But…</h2>
<div class="outline-text-2" id="text-3">
<p>
There is a lot of things to improve:
</p>
<ul class="org-ul">
<li>I'd like to be able to create a new project if it does not exist instead of having to create a new folder myself.
</li>
<li>directory-files lists all files in a directory, including non-folders and ".", "..". These need to be filtered out.
</li>
<li>Concatenating is ugly.
</li>
<li>After creating a note, I am using yasnippet to set the note skeleton. There should be a way to automize that.
</li>
</ul>
<p>
That first experience with Elisp was anyway encouraging as I used this function everyday. Stay tuned for other code dissection ;)
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Full code</h2>
<div class="outline-text-2" id="text-4">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defvar</span> <span class="nv">my/project-path</span> <span class="s">"~/Nextcloud/notes/projects"</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defun</span> <span class="nv">my/pick-project</span> <span class="p">()</span>
  <span class="s">"Prompt user to pick a choice from a list."</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">choices</span> <span class="p">(</span><span class="nf">directory-files</span> <span class="nv">my/project-path</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">message</span> <span class="s">"%s"</span> <span class="p">(</span><span class="nf">completing-read</span> <span class="s">"Open bookmark:"</span> <span class="nv">choices</span> <span class="p">))))</span>

<span class="p">(</span><span class="nf">defun</span> <span class="nv">my/choose-note-name</span> <span class="p">()</span>
  <span class="s">"Prompt user to choose a note name"</span>
  <span class="p">(</span><span class="nf">read-string</span> <span class="s">"Choose the note name: "</span><span class="p">))</span>


<span class="p">(</span><span class="nf">defun</span> <span class="nv">my/create-note-name</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">project-name</span> <span class="p">(</span><span class="nf">my/pick-project</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">note-name</span> <span class="p">(</span><span class="nf">my/choose-note-name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">concatenate</span> <span class="ss">'string</span>
		 <span class="nv">me/project-path</span>
		 <span class="s">"/"</span>
		 <span class="nv">project-name</span>
		 <span class="s">"/"</span>
		 <span class="nv">note-name</span>
		 <span class="s">".org"</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">defun</span> <span class="nv">my/create-new-project-note</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">filename</span> <span class="p">(</span><span class="nf">my/create-note-name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">find-file-other-window</span> <span class="nv">filename</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">org-mode</span><span class="p">)))</span>
</pre></div>
</div>
</div> </div>
        
    <div class="meta">
        <span class="date">
            <time class="published" datetime="2018-04-16T22:04:33+09:00">2018-04-16 22:04</time></span>
        <ul class="tags">
<li><a href="categories/emacs/">emacs</a></li>
            <li><a href="categories/learning/">learning</a></li>
        </ul>
<span class="comment-count">
            
        
    <a href="http://snoozetime.github.io/posts/creating-notes-for-different-project-with-orgmode-and-emacs/#disqus_thread" data-disqus-identifier="cache/posts/creating-notes-for-different-project-with-orgmode-and-emacs.html">Comments</a>


        </span>
    </div>

    </div>


        <h2> Archive </h2>

    <div id="home">
        <ul id="blog-posts" class="posts">
<li>
        <a class="title" href="posts/kucoin-rest-api-reality-check/">Kucoin REST API, reality check</a>
        <div class="meta">
            <span class="date">
                <time class="published" datetime="2018-04-05T18:06:41+09:00">2018-04-05</time></span>
            <ul class="tags">
<li><a href="categories/cryptocurrency/">cryptocurrency</a></li>
            </ul>
</div>
    </li>

        </ul>
</div>

    

    
        
       <script>var disqus_shortname="https-snoozetime-github-io";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><div class="footer">
                <small>Contents © 2018         <a href="mailto:benoit.eudier@gmail.com">Snoozetime</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </small>
            </div>
        </div>
    </div>
    
            <script src="assets/js/jquery-1.10.2.min.js" type="text/javascript"></script>
</body>
</html>
