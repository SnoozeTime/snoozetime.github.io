<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Code generation with Python - How learning Python can save you a bunch of time | Snoozetime's webpage</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#400000">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://snoozetime.github.io/posts/code-generation-python/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Snoozetime">
<link rel="prev" href="../fantasy-novel-series-and-the-wait/" title="Fantasy novel series, and the Wait" type="text/html">
<link rel="next" href="../random-pictures-in-japan-1/" title="Random pictures in Japan 1" type="text/html">
<meta property="og:site_name" content="Snoozetime's webpage">
<meta property="og:title" content="Code generation with Python - How learning Python can save you a bunch">
<meta property="og:url" content="http://snoozetime.github.io/posts/code-generation-python/">
<meta property="og:description" content="More often than not, working in a IT project requires a lot of repetitive
tasks. In particular, one area that can be very debilitating is the creation
of test data. We know it is indispensable to the ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-05-02T00:00:00+09:00">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="python">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="http://snoozetime.github.io/">

            <span id="blog-title">Snoozetime's webpage</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="index.org" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../index.html" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="../../categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Code generation with Python - How learning Python can save you a bunch of time</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Snoozetime
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2018-05-02T00:00:00+09:00" itemprop="datePublished" title="2018-05-02 00:00">2018-05-02 00:00</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/code_generation_with_python.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>
More often than not, working in a IT project requires a lot of repetitive
tasks. In particular, one area that can be very debilitating is the creation
of test data. We know it is indispensable to the project, but it does not
make that task less boring.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Let's consider this example</h2>
<div class="outline-text-2" id="text-1">
<blockquote>
<p>
You are working in a Java project. One of the thing to test is the validation
logic of some input XML files. One object, called the
XmlInputSuperbEnterpriseValidator (notice the Java naming convention), takes
a XML file path as input and return true if the file is valid.
</p>
</blockquote>

<p>
Input file is just a simple XML file, which could look like this:
</p>
zsh:1: command not found: pygmentize
<p>
where value1 accepts number between 0 and 9 and value2 accepts letters (a-z).
</p>

<p>
To test this, one can create a test class like the following.
</p>
zsh:1: command not found: pygmentize

<p>
Then, for each test case, create the XML file and add exactly the same test
function.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">When things go sideways</h2>
<div class="outline-text-2" id="text-2">
<p>
What if you have 50 different permutations of XML file. You'll need to create
all of them and create the exact same test methods. And what if the
specification change and you have to add new fields? Here again, a lot of
manual operation will be required to update the test cases.
</p>

<p>
What could happen here is that the tests will just be thrown away as the
maintenance is taking more effort that most people are willing to give.
</p>

<p>
As a good little software engineer, one of the question that should pop out
of your mind is: "Isn't there a better way to do that?"
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Of course there is a better way</h2>
<div class="outline-text-2" id="text-3">
<p>
It's not rocket science, but using python (or any other language really) to
automate the test creation will save you a bunch of time and also make
everybody in the project happier.
</p>

<p>
The basic workflow is the following:
</p>
<ol class="org-ol">
<li>Create test data definition: It could be just a simple text file that
describes the tests you want to run.
</li>
<li>Run the script to generate the data and the test class
</li>
<li>Run the tests and enjoy
</li>
</ol>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Test definition</h3>
<div class="outline-text-3" id="text-3-1">
<p>
The test definition is the input of the generator. We need to specify what
kind of test data we want to generate. In this example, we want to generate
tests that will try all possible permutations for value1 and value2 of the
input file.
</p>

<p>
The format of the test definition is up to you; here we will just use plain
text.
</p>

<pre class="example">
1,2,3,4,5,6,7,8,9
a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z
</pre>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Generating the test data and test class</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1">Representing our test data in Python</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
First things first, let's create a class that will represent the data for one
test:
</p>
zsh:1: command not found: pygmentize

<p>
We have our test data representation, great. Now we need a way to convert it
to text. We could just use Python string interpolation but there is a much
better way.
</p>
</div>
</div>

<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2">Templating language, Yokoso</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
A very neat way to generate text file in python is to use a templating
language. Web frameworks, such as Django or Flask, are heavy users of templating
language to generate the HTML pages from data coming from the server.
</p>

<p>
Here, we will use <a href="http://jinja.pocoo.org/docs/2.10/">jinja2</a> to generate our XML and java files.
First, define the template using jinja templating language. Quick way is just
to define it as a string in the python file but it can also be read from file,
which is better practice when the templates are getting bigger and more numerous.
</p>

zsh:1: command not found: pygmentize

<p>
Notice the curly brackets? Jinja will replace what's inside by whatever objects
we pass. Object should have variables 'value1' and 'value2' to work.
</p>

<p>
The next snippet will print this template with a test case object.
</p>

zsh:1: command not found: pygmentize

<p>
We insert the test<sub>case</sub> variable in the template by passing it as a keyword argument
of the render method of jinja2.Template. This will print:
</p>

zsh:1: command not found: pygmentize

<p>
Creating the template for the java test class can be done in a similar fashion.
Here, we will leverage the for loop of jinja.
</p>

zsh:1: command not found: pygmentize

<p>
The variable to insert in the template is test<sub>cases</sub>. It should be an iterable as we use
it in the for loop. Here how to generate 1000 test cases with the java class to test them.
</p>

zsh:1: command not found: pygmentize

<p>
Instead of printing the rendered templates to the console, we will just write them to
a file.
</p>
</div>
</div>

<div id="outline-container-sec-3-2-3" class="outline-4">
<h4 id="sec-3-2-3">Glue everything together</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
We have a way to represent our tests, we have a way to print our tests to file, we just need
to have a way to read our test specification and convert it to a TestCase object.
</p>

<p>
Our input file first line is the value1, and the second line is the value2. To avoid cluttering
the blog post, I will assume the file is always correct and has as many elements in the first
line than in the second line.
</p>

zsh:1: command not found: pygmentize

<p>
Then you can combine these value the way you want to create your test cases.
</p>

<p>
Using zip:
</p>
zsh:1: command not found: pygmentize

<p>
zip will create a generator from many iterables. The ith element of a zip object is a tuple containing
the ith elements of each of the input iterables. For example,
</p>

zsh:1: command not found: pygmentize

<p>
Will print "1 - 2" and "3 - 4".
</p>

<p>
zip is combined with enumerate. Enumerate is also very simple. It takes an iterator. The ith element
of enumerate is (i, ith element of input iterator).
</p>

zsh:1: command not found: pygmentize
<p>
Will print "Index 0: a" and "Index 1: b". Notice that when combining zip with enumerate, you need
to add brackets when unpacking the values. Not using brackets would throw a ValueError (not enough
values to unpack (expected 3, got 2). The reason is that enumerate is sending a tuple of size two.
</p>

<p>
Another way to combine test cases is to use itertools.product. Product will yield all combinaisons
possible of multiple iterables.
</p>

zsh:1: command not found: pygmentize

<p>
will print:
1 - a
1 - b
1 - c
2 - a
2 - b
2 - c
</p>

<p>
You can use product to test all the possible combinaisons of your input values.
</p>

zsh:1: command not found: pygmentize

<p>
There is so much to say about generators, iterators.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Generalizing this approach</h2>
<div class="outline-text-2" id="text-4">
<p>
In this post, we learned about how to use python and jinja2 to automate test creation. Instead of
spending your precious time writing boilerplate code, you can just focus on what you want to test.
</p>

<p>
This is a simple example, the concept of automation is very powerful and helps tremendously in every
day life. Even if your activities do not imply coding, there must be some repetitive task that can
be automize. For example, sending the same mail to each mail address in an excel spreadsheet. This
can be automized (see pandas to read from excel file).
</p>

<p>
If you're interested in the subject, have a look at <a href="https://automatetheboringstuff.com/">automate the boring stuff with Python.</a>
</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/programming/" rel="tag">programming</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../fantasy-novel-series-and-the-wait/" rel="prev" title="Fantasy novel series, and the Wait">Previous post</a>
            </li>
            <li class="next">
                <a href="../random-pictures-in-japan-1/" rel="next" title="Random pictures in Japan 1">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="https-snoozetime-github-io",
            disqus_url="http://snoozetime.github.io/posts/code-generation-python/",
        disqus_title="Code generation with Python - How learning Python can save you a bunch of time",
        disqus_identifier="cache/posts/code_generation_with_python.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="https-snoozetime-github-io";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2018         <a href="mailto:benoit.eudier@gmail.com">Snoozetime</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
